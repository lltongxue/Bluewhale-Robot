# PathDrawer

利用小强可以建立出周围环境的三维地图，但是如何利用这个地图实现视觉循迹呢？视觉导航路径编辑器就是为了实现这个功能而编写的。通过这个软件你可以在三维空间中标记你想要小强运动的轨迹。然后将生成的轨迹文件导出给小强，小强就能按照你标定的轨迹进行运动了。下面就详细介绍一下软件的使用方法。

#### 安装
软件提供了Ubuntu 的deb安装包可以在[这里](http://bwbot.org/static/CACHE/path-drawer_1.0.0_amd64.deb)下载
下载完成后执行一下指令安装
```
sudo dpkg -i path-drawer_1.0.0_amd64.deb
```
等待安装完成即可

#### 采集空间数据
路径编辑器需要载入小强采集的空间数据才能够进行操作，详细的操作可以参考这一篇。
点击保存按钮之后，地图信息会被保存到 ```/home/xiaoqiang/slamdb```文件夹内。

#### 启动软件
安装完成后可以在Ubuntu的Dash菜单中找到名为Path Drawer的程序，点击启动即可。
![0_1467106335113_Screenshot from 2016-06-28 17:32:06.png](http://community.bwbot.org/uploads/files/1467106348443-screenshot-from-2016-06-28-17-32-06.png) 

#### 导入数据
启动后的软件界面如图所示
![0_1467106412161_Screenshot from 2016-06-28 17:33:21.png](http://community.bwbot.org/uploads/files/1467106424560-screenshot-from-2016-06-28-17-33-21.png) 
在左上角的菜单中选择文件->导入地图数据。在弹出的文件选择对话框中选择 ```/home/xiaoqiang/slamdb/mappoints.bson```文件。
成功导入后就能在软件中看到地图点的数据。这是从上向下的俯视图。
![0_1467106586049_Screenshot from 2016-06-28 17:36:19.png](http://community.bwbot.org/uploads/files/1467106596417-screenshot-from-2016-06-28-17-36-19.png) 
然后继续在左上角的菜单中选择文件->导入路径文件。在弹出的文件选择对话框中选择```/home/xiaoqiang/slamdb/keyframes.bson```文件。
成功导入后能在软件中看到之前小车行走的路径。
![0_1467106782827_Screenshot from 2016-06-28 17:39:33.png](http://community.bwbot.org/uploads/files/1467106793840-screenshot-from-2016-06-28-17-39-33.png) 

#### 绘制导航路线
导航路线就是你想要小强行走的路径。当数据导出到小强后，小强就会按照你画的路径进行移动。下面介绍一下路径绘图工具的使用方法。
1. 基本操作
基本操作包括平移和缩放。如果鼠标左键拖动地图可以实现地图的平移。鼠标滚轴前后滚动可以实现地图的缩放，这在绘制路径的过程中非常的有用。对于对运动要求比较细致的地方可以放大后进行绘图。
2. 直线工具
点击左侧工具栏里的铅笔一样的图标。这就是直线工具。鼠标左键点击图上任意一点，然后移动鼠标就会出现一条红色直线。移动鼠标到想要的终止位置，再次点击鼠标左键，一条直线就绘制完成了。在点击一次左键之后，点击右键就可以取消此次绘图。
![0_1467107213569_Screenshot from 2016-06-28 17:46:45.png](http://community.bwbot.org/uploads/files/1467107223989-screenshot-from-2016-06-28-17-46-45.png) 
3. 橡皮擦工具
点击左侧工具栏中的橡皮擦工具，然后按下鼠标左键进行拖动就可以擦除之前绘制的点。
![0_1467107312249_Screenshot from 2016-06-28 17:48:23.png](http://community.bwbot.org/uploads/files/1467107322407-screenshot-from-2016-06-28-17-48-23.png) 
4. 曲线工具
点击左侧曲线工具，在曲线的起始点点击鼠标左键，然后在曲线的中间的再次点击一次鼠标左键，最后在曲线的结束点点击鼠标左键。这样一条曲线就绘制完成了。
![0_1467107546476_Screenshot from 2016-06-28 17:52:16.png](http://community.bwbot.org/uploads/files/1467107557847-screenshot-from-2016-06-28-17-52-16.png) 
5. 删除工具
如果想要大范围的删除之前绘制的点，那么就可以利用这个删除工具。点击左侧的删除工具然后鼠标左键点击删除的起始点，可以看到在鼠标的移动过程中有一个矩形一直在跟随。再次点击鼠标左键就可以删除矩形选中的范围。右键可以取消选择。

利用这几个工具就可以绘制出小强的导航路径了。注意要尽量沿着原有的轨迹进行来画线，这样可以保证在运动过程中路线是畅通的。从绿色的地图点可以大致看出地形，根据这些信息画出运动所范围允许的点。

#### 设置导航关键点
对于比较复杂的图形可能运动的方式有很多种。比如一个8字形路径，小强可能先绕其中的一个圆运动，然后再绕另一个圆运动，也可以两个圆交叉的运动。所以很有必要指明小强运动的具体方式。
下面以一个圆形轨迹为例。在圆形轨迹中，小强可以顺时针运动，同时也可能是逆时针运动。
![0_1467108435355_Screenshot from 2016-06-28 18:05:04.png](http://community.bwbot.org/uploads/files/1467108449340-screenshot-from-2016-06-28-18-05-04.png) 

点击左侧工具栏最下面的导航点设置按钮。然后开始标记关键点。随意点击导航路线上的一个点，可以看到，在这个点上出现了一个0. 这就表明0号点已经被添加到此处。
![0_1467108613778_Screenshot from 2016-06-28 18:08:53.png](http://community.bwbot.org/uploads/files/1467108624217-screenshot-from-2016-06-28-18-08-53.png) 
如果想要小强逆时针运动，就可以在右侧标记一个点。就这样依次把关键点加上
![0_1467108733738_Screenshot from 2016-06-28 18:12:07.png](http://community.bwbot.org/uploads/files/1467108744937-screenshot-from-2016-06-28-18-12-07.png) 

点击鼠标右键可以删除最近添加的一个导航点。同样也可以利用橡皮擦和删除工具来删除导航点。小强会按照关键点标记的顺序进行运动。

####
导出数据
1. 导出导航路径文件
当导航路径绘制完成之后，在左上角的菜单中点击文件->导出导航路径文件，选择文件保存的位置即可。在导出文件后还可以从菜单中导入，进行二次编辑。
2. 导出导航关键点文件
当导航关键点绘制完成之后，在左上角的菜单中点击文件->保存导航点，选择文件的保存位置即可。 在导出文件后同样也可以再次从菜单中导入，进行二次编辑。注意：只能在导航路径文件导入成功之后才能导入导航关键点。

导出的数据放入小强的对应文件夹内就可以开始视觉导航了。

Enjoy it!
